<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>BlueSTSDK: Readme</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueSTSDK
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Bluetooth low energy Sensors Technology protocol Software Development Kit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Readme </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>#BlueST SDK</p>
<p>This is an Android library that permit to easily access to the data exported by a Bluetooth low energy device that follow the BlueST protocol.</p>
<h2>BlueST Protocol</h2>
<h3>Advertise</h3>
<p>The library will show only the device that has a vendor specific field formatted in this way:</p>
<table class="doxtable">
<tr>
<th>Length</th><th>1 </th><th>1 </th><th>1 </th><th>1 </th><th>4 </th><th>6  </th></tr>
<tr>
<td>Name </td><td>length </td><td>field type </td><td>protocol version </td><td>device Id </td><td>feature mask </td><td>Device MAC (optional) </td></tr>
<tr>
<td>Value </td><td>0x07/0xD </td><td>0xFF </td><td>0x01 </td><td>0xXX </td><td>0xXXXXXXXX </td><td>0xXXXXXXXXXXXX </td></tr>
</table>
<ul>
<li>The field length must be of 7 or 13 byte.</li>
<li>The device Id is a number that identify the type of device, it is used for select different type of feature mask and be able to manage more than 32 feature. Actually the value that are used are:</li>
<li>0x00 for a generic device.</li>
<li>0x01 is reserved for the STEVAL-WESU1 board</li>
<li>0x80 for a generic Nucleo board.</li>
</ul>
<p>You should use a value between 0x02 and 0x7F if you are running the protocol in a specific board, or a value between 0x80 and 0xFF if the protocol is running in a Nucleo board.</p>
<ul>
<li>The feature mask is a bit field that permit to understand what characteristics/feature are exported by the board. Actually the bit are mapped in this way:</li>
</ul>
<p>|Bit|31|30|29|28|27|26|25|24|23|22|21|20|19|18|17|16| |:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:| |Feature|RFU|RFU|RFU|RFU|RFU|RFU|Proximity|Lux|Acc|Gyro|Mag|Pressure|Humidity|Temperature|Battery|RFU|</p>
<p>|Bit|15|14|13|12|11|10|9|8|7|6|5|4|3|2|1|0| |:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:|:-:| |Feature|RFU|RFU|RFU|RFU|RFU|RFU|RFU|Sensor Fusion Compact|Sensor Fusion|RFU|RFU|Activity|Curry Position|RFU|RFU|RFU| You can use one of the RFU bit or define a new device and decide how map the feature. For see how the data are exported by the already defined features, look the method <em>int extractData(long,byte[],int)</em> inside the feature class definition.</p>
<ul>
<li>The device mac address is optional since Andorid has the API to read it, it has a meaning when you need to know the mac address in an iOS environmental</li>
</ul>
<h3>Characteristics/Features</h3>
<p>The characteristics manage by the SDK must have an UUID like: <code>*XXXXXXXX*-0001-11e1-ac36-0002a5d5c51b</code>. The SDK will scan all the services looking for characteristics that match that pattern, so the service where they are stored doesnâ€™t matter.</p>
<p>The first part of the UUID will have the bit set to 1 for each feature exported by the characteristics.</p>
<p>In case of multiple feature mapped in a single characteristic the data must be in the same order of bit definition.</p>
<p>The characteristic data format must be like:</p>
<table class="doxtable">
<tr>
<th align="center">Length </th><th align="center">2 </th><th align="center">&gt;1 </th><th align="center">&gt;1  </th></tr>
<tr>
<td align="center">Name </td><td align="center">Timestamp </td><td align="center">first feature data </td><td align="center">second feature data </td></tr>
</table>
<p>The first 2 byte are used to communicate a time stamp that can be used to understand if we lost some package.</p>
<p>Since the Bluetooth low energy max length for a package is 20bytes, the max size for a feature data field is 18byte.</p>
<h3>Special Services</h3>
<h4><a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Debug.html">Debug</a></h4>
<p>If available the debug service must have the UUID <code>0000000-0000E-11e1-9ab4-0002a5d5c51b</code> and will contains 2 characteristics:</p>
<ul>
<li><code>00000001-000E-11e1-ac36-0002a5d5c51b</code> (Notify/Write) used for send string command to the board and notify the result.</li>
<li><code>00000002-000E-11e1-ac36-0002a5d5c51b</code> (Notify) it is used by the board for notify error message</li>
</ul>
<h4>Configuration</h4>
<p>If available the configuration service must have the UUID <code>00000000-000F-11e1-ac36-0002a5d5c51b</code> and will contain 2 characteristics:</p>
<ul>
<li><code>00000002-000F-11e1-ac36-0002a5d5c51b</code> (Notify/Write): it can be used for send command/data to a specific feature.</li>
</ul>
<p>The request message must have the format:</p>
<table class="doxtable">
<tr>
<th align="center">Length </th><th align="center">4 </th><th align="center">1 </th><th>0-15  </th></tr>
<tr>
<td align="center">Name </td><td align="center">Destination feature mask </td><td align="center">Command Id </td><td>Command data </td></tr>
</table>
<p>Where the first 4 bytes will select the feature that have to receive the command/data package.</p>
<p>The optional command answer must have the format:</p>
<table class="doxtable">
<tr>
<th align="center">Length </th><th align="center">2 </th><th align="center">4 </th><th align="center">1 </th><th align="center">0-13  </th></tr>
<tr>
<td align="center">Name </td><td align="center">Timestamp </td><td align="center">Sender feature mask </td><td align="center">Command Id </td><td align="center">Answer data </td></tr>
</table>
<p>From the sdk point of view the messages are send using the method <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Feature.html#sendCommand-byte-byte:A-">Feature.sendCommand</a> and the answer will be notify with a call back in the method <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Feature.html#parseCommandResponse-int-byte-byte:A-">Feature.parseCommandResponse</a>.</p>
<ul>
<li><code>00000002-000F-11e1-ac36-0002a5d5c51b</code> (Read/Write/Notify): if available it is used for access to the board configuration register that can be modify using the <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Config/ConfigControl.html">ConfigControl</a> class.</li>
</ul>
<h2>How to install the library</h2>
<h3>Has external library</h3>
<ol type="1">
<li>Clone the repository</li>
<li>Add the BlueSTSDK directory as submodule of your project: File-&gt;Import Module</li>
</ol>
<h3>Has git submodule</h3>
<ol type="1">
<li>Add the repository as submodule:</li>
</ol>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ git submodule add https://github.com/STclab/stm32nucleo-spirit1-lib.git BlueSTSDK</div>
</div><!-- fragment --><ol type="1">
<li>Add the sdk as project submodule in the <em>settings.gradle</em> adding the line: <pre>include ':BlueSTSDK:BlueSTSDK'</pre></li>
</ol>
<h2>Main library actors</h2>
<h3><a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Manager.html">Manager</a></h3>
<p>This is a singleton class that start/stop the discovery process and store the found nodes. Before starting the scanning process is also possible define new deviceId and register/add new features for the already defined devices</p>
<p>The Manager will notify a node discovery through the <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Manager.ManagerListener.html"><code>Manager.ManagerListener</code></a> class. Note that each call back are done asynchronous in a different thread for be asynchronous.</p>
<h3><a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Node.html">Node</a></h3>
<p>This class represent a remote device.</p>
<p>From this class you can recover what features are exported by the node and read write data from/to the device. The node will export all the feature that are set to 1 in the advertise message, after the connection the feature that are found scanning the available characteristics will became enabled and will be possible request data.</p>
<p>It will notify change of the rssi through the <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Node.BleConnectionParamUpdateListener.html"><code>Node.BleConnectionParamUpdateListener</code></a> class. It will notify change of its state through the <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Node.NodeStateListener.html"><code>Node.NodeStateListener</code></a> class.</p>
<p>The possible state are:</p><ul>
<li><b>Idle</b>: the node is waiting for a connection and it is sending advertise message</li>
<li><b>Connecting</b>: we open a connection with the node, waiting to discovering the device services/characteristics</li>
<li><b>Connected</b>: we are connected with the node. Note: this status can be fired 2 times if we do a secure connection using bt pairing</li>
<li><b>Disconnecting</b>: we are closing the node connection, at the end the node will be in a idle status</li>
<li><b>Lost</b>: the device send an advertise, but now we didn't see any update</li>
<li><b>Unreachable</b>: we were connected with the node but now it is disappears without disconnecting</li>
</ul>
<p>Note that each call back are done asynchronous in a different thread for be asynchronous.</p>
<h3><a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Feature.html">Feature</a></h3>
<p>This class represent a data exported by the node.</p>
<p>Each Feature has an array of <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Features/Field.html"><code>Field</code></a> that describe the data exported by the feature.</p>
<p>The data are received from a BLE characteristics and the class will create <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Feature.Sample.html"><code>Feature.Sample</code></a> that will be notify to the user using a listener pattern.</p>
<p>The data exported by the Sample can be extracted using the static utility methods that each class make available.</p>
<p>Note that each call back are done asynchronous in a different thread for be asynchronous.</p>
<p>The already available feature are inside the <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Features/package-frame.html">Features package</a>.</p>
<h4>How to add a new Feature</h4>
<ol type="1">
<li>Extend the class Feature:</li>
</ol>
<ol type="1">
<li>Create an array of <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Features/Field.html"><code>Feature.Field</code></a> that will describe the data exported by the new feature</li>
<li>Create a constructor that accept only the node as parameter. From this constructor call the <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Feature.html#Feature-java.lang.String-com.st.BlueSTSDK.Node-com.st.BlueSTSDK.Features.Field:A-">super constructor</a>, passing the feature name and the feature field</li>
<li>Implement the method <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc/com/st/BlueSTSDK/Feature.html#extractData-long-byte:A-int-"><code>int Feature.extractData(long,byte[],int)</code></a> where you have to create the sample object and assign it to the instance variable <code>mLastSample</code></li>
</ol>
<ol type="1">
<li>Create a utility static method that extract the data from the Feature.Sample class</li>
</ol>
<ol type="1">
<li>Before start the scanning register the new feature</li>
</ol>
<div class="fragment"><div class="line"><span class="comment">// add the feature to the Nucleo device</span></div>
<div class="line">byte deviceId = (byte) 0x80;</div>
<div class="line">SparseArray temp = <span class="keyword">new</span> SparceArray();</div>
<div class="line"><span class="comment">// the feature will be mapped in the characteristic </span></div>
<div class="line"><span class="comment">// 0x10000000-0001-11e1-ac36-0002a5d5c51b</span></div>
<div class="line">temp.append(0x10000000,MyNewFeature.class);</div>
<div class="line"><span class="keywordflow">try</span> {</div>
<div class="line">Manager.addFeatureToNode(deviceId,temp);</div>
<div class="line">} <span class="keywordflow">catch</span> (InvalidFeatureBitMaskException e) {</div>
<div class="line">e.printStackTrace();</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Docs</h2>
<p>You can found the javadoc on this link: <a href="https://stclab.github.io/BlueSTSDK_Android/javadoc">JavaDoc</a></p>
<h2>License</h2>
<p>COPYRIGHT(c) 2015 STMicroelectronics</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p><ol type="1">
<li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
<li>Neither the name of STMicroelectronics nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</li>
</ol>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 18 2015 15:54:23 for BlueSTSDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
